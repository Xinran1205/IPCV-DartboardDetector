# Dartboard Detection System

## 项目概述
本项目是开发一个使用计算机视觉技术检测飞镖靶的系统，主要采用了Viola-Jones检测器和霍夫变换（包括霍夫圆变换和霍夫直线变换）。项目的创新之处在于在Viola-Jones检测出的区域内应用霍夫变换，这种方法不仅提高了检测的准确性和效率，而且确保了系统的真阳性率（TPR）始终为1，同时将平均F1分数提高到了82%。所有的霍夫变换和优化代码均为我亲自编写，未使用任何现成的库。

## 流程细节
### 1. 初步检测：
- 使用训练好的Viola-Jones检测器对16张图像进行飞镖靶检测，通过调整`detectMultiScale`函数的参数（如`minSize`、`maxSize`、`scaleFactor`和`minNeighbors`）来确保每张图片的真阳性率（TPR）接近1，同时尽量提高F1分数。
- 使用IoU（交并比）来验证检测框与真实目标（ground truth）的匹配程度。

### 2. 优化和精确检测：
- 在Viola-Jones检测出的区域内使用霍夫圆变换，这个创新方法显著提高了检测的准确性和效率。
- 通过NMS（非极大值抑制）、双阈值法、以及对检测区域的微调等多种技术提高检测精确性和减少假阳性。
- 匹配过滤确保每个检测区域中只保留最匹配的圆，以及全局过滤去除重复或相似的圆形。

### 3. 结合霍夫直线变换：
- 新增霍夫直线变换，对每个检测到的圆的区域进行分析，确认是否有足够数量的直线汇聚于圆心。
- 如果直线数量未达到预定阈值，该圆将被排除，进一步提升系统的筛选精度。

## 技术解释与优化措施
### 在Viola-Jones检测出的区域内进行霍夫变换的原因
1. **高TPR避免漏检**：我通过Viola-Jones检测器初步检测并覆盖所有可能的目标区域，每个真实目标至少与一个检测框有重叠，因此，在这些检测框内应用霍夫圆变换，有效避免了漏检的问题。
2. **提高算法效率**：我仅在Viola-Jones检测出的区域内执行霍夫圆变换，而非整个图像，显著提高了处理速度。这种局部处理不仅节省了计算资源，还极大缩短了运行时间。
3. **精确性的局部处理**：我在局部区域应用霍夫变换，更精确地处理这些已被标识为可能包含目标的区域。利用交并比（IOU）评估每个圆形检测结果的准确性，并据此精确计算TPR和F1分数。

### 进一步的优化方法
1. **应用非极大值抑制（NMS）**：我对Viola-Jones算法识别的区域应用了非极大值抑制，有效减少了图像中同一区域的重复检测，避免了冗余的检测框。
2. **使用Sobel算子和NMS**：我利用Sobel算子计算边缘梯度大小，并应用特定的NMS方法，确保只保留最显著的边缘点，减少厚边问题，提高了边缘检测的清晰度。
3. **双阈值法**：我在执行霍夫变换前，应用了双阈值法对梯度大小进行处理，区分强边缘和弱边缘，仅保留明显的强边缘，从而提高了霍夫变换的准确性。
4. **匹配过滤和全局过滤**：在每个Viola-Jones检测框中最多只保留一个最匹配的圆。最后，我还对全局所有圆形进行再次过滤，根据相似性（IOU计算）去除较小或较相似的圆，优先保留较大的圆，有效避免了大圆套小圆的情况。

### 检测器检测结果示例
<img src="/pic/1.jpg" alt="sample" width="250" height="160">
